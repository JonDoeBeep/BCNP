<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BCNP: BCNP Schema &amp; Code Generation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">BCNP<span id="projectnumber">&#160;3.2.1</span>
   </div>
   <div id="projectbrief">Batched Command Network Protocol</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_schema.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">BCNP Schema &amp; Code Generation</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md0"></a></p>
<blockquote class="doxtable">
<p>&zwj;Define message types in JSON, generate type-safe C++ and Python code automatically. </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md1"></a>
</h1>
<h1><a class="anchor" id="autotoc_md2"></a>
Overview</h1>
<p>The BCNP schema system provides:</p>
<ul>
<li>JSON schema</li>
<li>Code generation</li>
<li>Schema hashing</li>
<li>Type safety</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md4"></a>
Files</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">File   </th><th class="markdownTableHeadNone">Purpose    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>messages.json</code>   </td><td class="markdownTableBodyNone">Your message type definitions (edit this)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>bcnp_schema.json</code>   </td><td class="markdownTableBodyNone">JSON Schema for validating messages.json    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="bcnp__codegen_8py.html">bcnp_codegen.py</a></code>   </td><td class="markdownTableBodyNone">Code generator script   </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="autotoc_md6"></a>
Quick Start</h1>
<h2><a class="anchor" id="autotoc_md7"></a>
1. Define Messages</h2>
<p>Edit <code>messages.json</code>:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;version&quot;: &quot;3.2&quot;,</div>
<div class="line">  &quot;namespace&quot;: &quot;bcnp&quot;,</div>
<div class="line">  &quot;messages&quot;: [</div>
<div class="line">    {</div>
<div class="line">      &quot;id&quot;: 1,</div>
<div class="line">      &quot;name&quot;: &quot;DriveCmd&quot;,</div>
<div class="line">      &quot;description&quot;: &quot;Differential drive velocity command&quot;,</div>
<div class="line">      &quot;fields&quot;: [</div>
<div class="line">        {&quot;name&quot;: &quot;vx&quot;, &quot;type&quot;: &quot;float32&quot;, &quot;scale&quot;: 10000, &quot;unit&quot;: &quot;m/s&quot;},</div>
<div class="line">        {&quot;name&quot;: &quot;omega&quot;, &quot;type&quot;: &quot;float32&quot;, &quot;scale&quot;: 10000, &quot;unit&quot;: &quot;rad/s&quot;},</div>
<div class="line">        {&quot;name&quot;: &quot;durationMs&quot;, &quot;type&quot;: &quot;uint16&quot;, &quot;unit&quot;: &quot;ms&quot;}</div>
<div class="line">      ]</div>
<div class="line">    }</div>
<div class="line">  ]</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md8"></a>
2. Generate Code</h2>
<div class="fragment"><div class="line"># Generate C++ and Python</div>
<div class="line">python bcnp_codegen.py messages.json --cpp ../generated --python ../examples</div>
<div class="line"> </div>
<div class="line"># C++ only</div>
<div class="line">python bcnp_codegen.py messages.json --cpp ../generated</div>
<div class="line"> </div>
<div class="line"># View schema info (no file generation)</div>
<div class="line">python bcnp_codegen.py messages.json</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md9"></a>
3. Use Generated Code</h2>
<p><b>C++:</b> </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="message__types_8h.html">bcnp/message_types.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line">bcnp::DriveCmd cmd{.vx = 1.5f, .omega = 0.0f, .durationMs = 100};</div>
<div class="ttc" id="amessage__types_8h_html"><div class="ttname"><a href="message__types_8h.html">message_types.h</a></div></div>
</div><!-- fragment --><p><em>Python:</em> </p><div class="fragment"><div class="line"><span class="keyword">from</span> bcnp_messages <span class="keyword">import</span> DriveCmd, encode_packet</div>
<div class="line"> </div>
<div class="line">cmd = DriveCmd(vx=1.5, omega=0.0, durationMs=100)</div>
<div class="line">packet = encode_packet([cmd])</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md11"></a>
Adding a New Message Type</h1>
<h2><a class="anchor" id="autotoc_md12"></a>
Step 1: Edit <code>messages.json</code></h2>
<p>Add a new entry to the <code>messages</code> array:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;id&quot;: 10,</div>
<div class="line">  &quot;name&quot;: &quot;ArmCmd&quot;,</div>
<div class="line">  &quot;description&quot;: &quot;Arm position command&quot;,</div>
<div class="line">  &quot;fields&quot;: [</div>
<div class="line">    {&quot;name&quot;: &quot;shoulderAngle&quot;, &quot;type&quot;: &quot;float32&quot;, &quot;scale&quot;: 10000, &quot;unit&quot;: &quot;rad&quot;},</div>
<div class="line">    {&quot;name&quot;: &quot;elbowAngle&quot;, &quot;type&quot;: &quot;float32&quot;, &quot;scale&quot;: 10000, &quot;unit&quot;: &quot;rad&quot;},</div>
<div class="line">    {&quot;name&quot;: &quot;gripperOpen&quot;, &quot;type&quot;: &quot;uint8&quot;},</div>
<div class="line">    {&quot;name&quot;: &quot;durationMs&quot;, &quot;type&quot;: &quot;uint16&quot;, &quot;unit&quot;: &quot;ms&quot;}</div>
<div class="line">  ]</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md13"></a>
Step 2: Run Codegen</h2>
<div class="fragment"><div class="line">python bcnp_codegen.py messages.json --cpp ../generated --python ../examples</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md14"></a>
Step 3: Rebuild &amp; Update</h2>
<ol type="1">
<li>Rebuild your C++ project</li>
<li>Update Python clients with new <code>bcnp_messages.py</code></li>
<li><b>Both sides must have matching schema hash</b></li>
</ol>
<hr  />
<h1><a class="anchor" id="autotoc_md16"></a>
Supported Field Types</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Wire Size   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>int8</code>   </td><td class="markdownTableBodyNone">1 byte   </td><td class="markdownTableBodyNone">Signed 8-bit integer    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>uint8</code>   </td><td class="markdownTableBodyNone">1 byte   </td><td class="markdownTableBodyNone">Unsigned 8-bit integer    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>int16</code>   </td><td class="markdownTableBodyNone">2 bytes   </td><td class="markdownTableBodyNone">Signed 16-bit integer (big-endian)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>uint16</code>   </td><td class="markdownTableBodyNone">2 bytes   </td><td class="markdownTableBodyNone">Unsigned 16-bit integer (big-endian)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>int32</code>   </td><td class="markdownTableBodyNone">4 bytes   </td><td class="markdownTableBodyNone">Signed 32-bit integer (big-endian)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>uint32</code>   </td><td class="markdownTableBodyNone">4 bytes   </td><td class="markdownTableBodyNone">Unsigned 32-bit integer (big-endian)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>float32</code>   </td><td class="markdownTableBodyNone">4 bytes   </td><td class="markdownTableBodyNone">Float encoded as int32 with scale factor   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md17"></a>
Float Encoding</h2>
<p><code>float32</code> fields use fixed-point encoding for platform independence:</p>
<div class="fragment"><div class="line">wire_value = (int32_t)(float_value * scale)</div>
<div class="line">float_value = wire_value / scale</div>
</div><!-- fragment --><p>Default scale: <code>10000</code> (4 decimal places, range Â±214,748.3647)</p>
<hr  />
<h1><a class="anchor" id="autotoc_md19"></a>
Message Definition Format</h1>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;id&quot;: 1,                              // Required: Unique ID (1-65535)</div>
<div class="line">  &quot;name&quot;: &quot;MessageName&quot;,                // Required: PascalCase identifier</div>
<div class="line">  &quot;description&quot;: &quot;What this does&quot;,      // Optional: Documentation</div>
<div class="line">  &quot;fields&quot;: [                           // Required: Array of fields</div>
<div class="line">    {</div>
<div class="line">      &quot;name&quot;: &quot;fieldName&quot;,              // Required: camelCase identifier</div>
<div class="line">      &quot;type&quot;: &quot;uint16&quot;,                 // Required: One of supported types</div>
<div class="line">      &quot;scale&quot;: 10000,                   // Optional: For float32 only</div>
<div class="line">      &quot;unit&quot;: &quot;m/s&quot;                     // Optional: Documentation only</div>
<div class="line">    }</div>
<div class="line">  ]</div>
<div class="line">}</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md21"></a>
Schema Hash</h1>
<p>The schema hash is a CRC32 computed from the canonical JSON representation of all message definitions. The hash is printed during codegen and embedded in generated code:</p>
<div class="fragment"><div class="line">Schema hash: 0x0152BCDB</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md23"></a>
Generated Output</h1>
<h2><a class="anchor" id="autotoc_md24"></a>
C++ Header (<code>message_types.h</code>)</h2>
<div class="fragment"><div class="line"><span class="keyword">namespace </span><a class="code hl_namespace" href="namespacebcnp.html">bcnp</a> {</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Protocol constants</span></div>
<div class="line"><span class="keyword">constexpr</span> uint8_t <a class="code hl_variable" href="namespacebcnp.html#ae6f804883e536bd67015b9ff23b7c8dd">kProtocolMajorV3</a> = 3;</div>
<div class="line"><span class="keyword">constexpr</span> uint8_t <a class="code hl_variable" href="namespacebcnp.html#ab32538d8c5b740d6ef7505b224df83fc">kProtocolMinorV3</a> = 2;</div>
<div class="line"><span class="keyword">constexpr</span> uint32_t <a class="code hl_variable" href="namespacebcnp.html#a9ca34194c90d0471f44a433dde42ae71">kSchemaHash</a> = 0x0152BCDB;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Message type enum</span></div>
<div class="line"><span class="keyword">enum class</span> <a class="code hl_enumeration" href="namespacebcnp.html#a14399a29891cebdd7f6b429bdc258744">MessageTypeId</a> : uint16_t {</div>
<div class="line">    <a class="code hl_enumvalue" href="namespacebcnp.html#a14399a29891cebdd7f6b429bdc258744a88183b946cc5f0e8c96b2e66e1c74a7e">Unknown</a> = 0,</div>
<div class="line">    DriveCmd = 1,</div>
<div class="line">    <span class="comment">// ... your types</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Generated struct</span></div>
<div class="line"><span class="keyword">struct </span>DriveCmd {</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">constexpr</span> MessageTypeId kTypeId = MessageTypeId::DriveCmd;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">constexpr</span> std::size_t kWireSize = 10;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">float</span> vx{0.0f};</div>
<div class="line">    <span class="keywordtype">float</span> omega{0.0f};</div>
<div class="line">    uint16_t durationMs{0};</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">bool</span> Encode(uint8_t* buffer, std::size_t size) <span class="keyword">const</span>;</div>
<div class="line">    <span class="keyword">static</span> std::optional&lt;DriveCmd&gt; Decode(<span class="keyword">const</span> uint8_t* buffer, std::size_t size);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace bcnp</span></div>
<div class="ttc" id="anamespacebcnp_html"><div class="ttname"><a href="namespacebcnp.html">bcnp</a></div><div class="ttdef"><b>Definition</b> <a href="command__queue_8h_source.html#l00008">command_queue.h:8</a></div></div>
<div class="ttc" id="anamespacebcnp_html_a14399a29891cebdd7f6b429bdc258744"><div class="ttname"><a href="namespacebcnp.html#a14399a29891cebdd7f6b429bdc258744">bcnp::MessageTypeId</a></div><div class="ttdeci">MessageTypeId</div><div class="ttdef"><b>Definition</b> <a href="message__types_8h_source.html#l00039">message_types.h:39</a></div></div>
<div class="ttc" id="anamespacebcnp_html_a14399a29891cebdd7f6b429bdc258744a88183b946cc5f0e8c96b2e66e1c74a7e"><div class="ttname"><a href="namespacebcnp.html#a14399a29891cebdd7f6b429bdc258744a88183b946cc5f0e8c96b2e66e1c74a7e">bcnp::MessageTypeId::Unknown</a></div><div class="ttdeci">@ Unknown</div></div>
<div class="ttc" id="anamespacebcnp_html_a9ca34194c90d0471f44a433dde42ae71"><div class="ttname"><a href="namespacebcnp.html#a9ca34194c90d0471f44a433dde42ae71">bcnp::kSchemaHash</a></div><div class="ttdeci">constexpr uint32_t kSchemaHash</div><div class="ttdef"><b>Definition</b> <a href="message__types_8h_source.html#l00024">message_types.h:24</a></div></div>
<div class="ttc" id="anamespacebcnp_html_ab32538d8c5b740d6ef7505b224df83fc"><div class="ttname"><a href="namespacebcnp.html#ab32538d8c5b740d6ef7505b224df83fc">bcnp::kProtocolMinorV3</a></div><div class="ttdeci">constexpr uint8_t kProtocolMinorV3</div><div class="ttdef"><b>Definition</b> <a href="message__types_8h_source.html#l00023">message_types.h:23</a></div></div>
<div class="ttc" id="anamespacebcnp_html_ae6f804883e536bd67015b9ff23b7c8dd"><div class="ttname"><a href="namespacebcnp.html#ae6f804883e536bd67015b9ff23b7c8dd">bcnp::kProtocolMajorV3</a></div><div class="ttdeci">constexpr uint8_t kProtocolMajorV3</div><div class="ttdef"><b>Definition</b> <a href="message__types_8h_source.html#l00022">message_types.h:22</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md25"></a>
Python Module (<code>bcnp_messages.py</code>)</h2>
<div class="fragment"><div class="line"><span class="preprocessor">@dataclass</span></div>
<div class="line"><span class="keyword">class </span>DriveCmd:</div>
<div class="line">    TYPE_ID = 1</div>
<div class="line">    WIRE_SIZE = 10</div>
<div class="line">    </div>
<div class="line">    vx: float = 0.0</div>
<div class="line">    omega: float = 0.0</div>
<div class="line">    durationMs: int = 0</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">def </span>encode(self) -&gt; bytes: ...</div>
<div class="line">    </div>
<div class="line">    <span class="preprocessor">@classmethod</span></div>
<div class="line">    <span class="keyword">def </span>decode(cls, data: bytes) -&gt; <span class="stringliteral">&#39;DriveCmd&#39;</span>: ...</div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>encode_packet(messages: List[Any], flags: int = 0) -&gt; bytes: ...</div>
</div><!-- fragment --><hr  />
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
